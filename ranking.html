<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>æ’è¡Œæ¦œ - Dynasty Taekwondo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f0f0f0;
      padding: 20px;
    }
    h2 {
      text-align: center;
      color: #003049;
    }
    .ranking-table {
      max-width: 1000px;
      margin: 20px auto;
      background: white;
      border-collapse: collapse;
      width: 100%;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }
    .ranking-table th,
    .ranking-table td {
      padding: 12px;
      border: 1px solid #ddd;
      text-align: center;
    }
    .ranking-table th {
      background-color: #a2d5f2;
    }
    .note {
      text-align: center;
      font-size: 14px;
      color: #666;
      max-width: 800px;
      margin: 20px auto;
      line-height: 1.6;
    }
  </style>
</head>
<body>
  <h2>ğŸ… å¹´åº¦ç§¯åˆ†æ’è¡Œæ¦œ<br>Annual Ranking</h2>

  <h3 style="text-align:center;">ğŸ¥‹ å“åŠ¿ Poomsae æ’è¡Œæ¦œ</h3>
  <table class="ranking-table" id="poomsaeTable">
    <thead>
      <tr>
        <th>åæ¬¡ Rank</th>
        <th>å­¦ç”Ÿå§“å Name</th>
        <th>èº«ä»½è¯å· NRIC</th>
        <th>æ€»ç§¯åˆ† Total Points</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h3 style="text-align:center;">ğŸ¥‹ ç«æŠ€ Kyorugi æ’è¡Œæ¦œ</h3>
  <table class="ranking-table" id="kyorugiTable">
    <thead>
      <tr>
        <th>åæ¬¡ Rank</th>
        <th>å­¦ç”Ÿå§“å Name</th>
        <th>èº«ä»½è¯å· NRIC</th>
        <th>æ€»ç§¯åˆ† Total Points</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="note">
    <strong>ç§¯åˆ†è®¡ç®—è§„åˆ™ï¼š</strong><br><br>
    <u>ğŸ† å›½é™…èµ›äº‹ï¼š</u>å‚ä¸ +10 åˆ†ï¼Œé“œç‰Œ +4ï¼Œé“¶ç‰Œ +6ï¼Œé‡‘ç‰Œ +8<br>
    <u>ğŸ‡²ğŸ‡¾ å…¨å›½èµ›äº‹ï¼š</u>å‚ä¸ +8 åˆ†ï¼Œé“œç‰Œ +3ï¼Œé“¶ç‰Œ +5ï¼Œé‡‘ç‰Œ +7<br>
    <u>å·çº§èµ›äº‹ï¼š</u>å‚ä¸ +6 åˆ†ï¼Œé“œç‰Œ +2ï¼Œé“¶ç‰Œ +4ï¼Œé‡‘ç‰Œ +6<br>
    <u>é‚€è¯·èµ›ï¼š</u>å‚ä¸ +4 åˆ†ï¼Œé“œç‰Œ +1ï¼Œé“¶ç‰Œ +2ï¼Œé‡‘ç‰Œ +3
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
  <script>
    const firebaseConfig = {
      // æ›¿æ¢æˆä½ çš„ Firebase é…ç½®
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const scoreRule = {
      International: { base: 10, Gold: 8, Silver: 6, Bronze: 4 },
      National: { base: 8, Gold: 7, Silver: 5, Bronze: 3 },
      State: { base: 6, Gold: 6, Silver: 4, Bronze: 2 },
      Invitational: { base: 4, Gold: 3, Silver: 2, Bronze: 1 }
    };

    async function buildRanking() {
      const snapshot = await db.collection("competition_results").get();
      const poomsaeScores = {};
      const kyorugiScores = {};

      snapshot.forEach(doc => {
        const d = doc.data();
        const key = d.studentNric;
        const base = scoreRule[d.level]?.base || 0;
        const bonus = scoreRule[d.level]?.[d.award] || 0;
        const total = base + bonus;

        if (d.category === "Poomsae") {
          poomsaeScores[key] = poomsaeScores[key] || { name: d.studentName, score: 0 };
          poomsaeScores[key].score += total;
        }
        if (d.category === "Kyorugi") {
          kyorugiScores[key] = kyorugiScores[key] || { name: d.studentName, score: 0 };
          kyorugiScores[key].score += total;
        }
      });

      function renderTable(data, tableId) {
        const rows = Object.entries(data)
          .sort((a, b) => b[1].score - a[1].score)
          .map(([nric, { name, score }], index) => `
            <tr>
              <td>${index + 1}</td>
              <td>${name}</td>
              <td>${nric}</td>
              <td>${score}</td>
            </tr>
          `).join("");
        document.querySelector(`#${tableId} tbody`).innerHTML = rows;
      }

      renderTable(poomsaeScores, "poomsaeTable");
      renderTable(kyorugiScores, "kyorugiTable");
    }

    buildRanking();
  </script>
</body>
</html>
